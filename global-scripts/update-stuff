#!/usr/bin/env bash
set -e

function iscommand
{
  hash "${1}" 2>/dev/null
}

function declare
{
  echo ""
  echo "----------------------------------------"
  echo "-  Updating ${@}"
  echo "----------------------------------------"
}

clear
date

if iscommand brew; then
  declare "Homebrew"
  brew update && brew upgrade
  # Casks need a little bit of a work-around
  outdated_casks="$(brew cask outdated | awk '{print $1}')"
  # There is a bug preventing us from uninstalling (and
  # therefore reinstalling) real-vnc, so we have to skip it
  # https://github.com/caskroom/homebrew-cask/issues/32300
  # http://tldp.org/LDP/abs/html/string-manipulation.html
  outdated_casks="${outdated_casks##real-vnc}"
  echo "${outdated_casks}" | xargs brew cask reinstall
  rm -rf "$(brew --cache)"
fi
if iscommand mas; then
  declare "Mac Application Store"
  mas upgrade
fi
if iscommand apt-get; then
  declare "apt-get"
  sudo apt-get update && sudo apt-get upgrade
fi
if iscommand npm; then
  declare "NPM"
  npm install npm@latest -g
  npm update -g
fi
if iscommand apm; then
  declare "Atom Packages"
  apm update --no-confirm
fi
if iscommand exercism; then
  declare "Exercism"
  exercism upgrade
fi
if iscommand mas; then
  declare "OSX Software Center (via mas)"
  mas upgrade
fi
